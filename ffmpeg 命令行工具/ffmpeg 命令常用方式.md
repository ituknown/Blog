# å‰è¨€

å®˜ç½‘åœ°å€ï¼šhttp://ffmpeg.org

GitHub åœ°å€ï¼šhttps://github.com/FFmpeg/FFmpeg

**ffmpeg å®‰è£…ï¼š**

```bash
# Mac ä¸‹ä½¿ç”¨ HomeBrew å®‰è£…
$ brew install -v ffmpeg

# CentOS/RHEL ç³»ç»Ÿå¯ä»¥ä½¿ç”¨ YUM åŒ…ç®¡ç†å·¥å…·å®‰è£…
$ yum install -y ffmpeg

# Debain/Ubuntu ç³»åˆ—ä½¿ç”¨ APT åŒ…ç®¡ç†å·¥å…·å®‰è£…
$ apt-get install -y ffmpeg
```

|**Note**|
|:-------|
|Windows ç³»ç»Ÿçš„è¯éœ€è¦å»å®˜ç½‘ä¸‹è½½å¯¹åº”çš„å®‰è£…ç‰ˆæœ¬ï¼Œæˆ–è€…ç›´æ¥åˆ°äºŒè¿›åˆ¶ä¸‹è½½é¡µé¢ä¸‹è½½ï¼š[https://github.com/BtbN/FFmpeg-Builds/releases](https://github.com/BtbN/FFmpeg-Builds/releases)|


å®‰è£…å®Œæˆä¹‹ååœ¨å¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥ `ffmpeg -version` å‘½ä»¤éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœè¾“å‡ºç±»ä¼¼å¦‚ä¸‹çš„ä¿¡æ¯å³è¡¨ç¤ºå®‰è£…æˆåŠŸäº†ï¼š

```bash
$ ffmpeg -version
ffmpeg version 4.3.3-0+deb11u1 Copyright (c) 2000-2021 the FFmpeg developers
built with gcc 10 (Debian 10.2.1-6)
configuration: --prefix=/usr --extra-version=0+deb11u1 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --arch=amd64 --enable-gpl --disable-stripping --enable-avresample --disable-filter=resample --enable-gnutls --enable-ladspa --enable-libaom --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libjack --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librabbitmq --enable-librsvg --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libsrt --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzmq --enable-libzvbi --enable-lv2 --enable-omx --enable-openal --enable-opencl --enable-opengl --enable-sdl2 --enable-pocketsphinx --enable-libmfx --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libx264 --enable-shared
libavutil      56. 51.100 / 56. 51.100
libavcodec     58. 91.100 / 58. 91.100
libavformat    58. 45.100 / 58. 45.100
libavdevice    58. 10.100 / 58. 10.100
libavfilter     7. 85.100 /  7. 85.100
libavresample   4.  0.  0 /  4.  0.  0
libswscale      5.  7.100 /  5.  7.100
libswresample   3.  7.100 /  3.  7.100
libpostproc    55.  7.100 / 55.  7.100
```


# æ‰¹é‡è§†é¢‘æ–‡ä»¶åˆæˆ

è¿™ä¸ªç”¨çš„æœ€å¤šçš„å°±æ˜¯åˆæˆ m3u8 è§†é¢‘ï¼ŒæŸäº›è§†é¢‘é“¾æ¥ğŸ”—æ˜¯ m3u8 æ ¼å¼ã€‚ä¸‹è½½ä¸‹æ¥åä¼šæ˜¯ä¸€å † `.ts` è§†é¢‘ï¼Œæ¯ä¸ª `.ts` è§†é¢‘ä»…ä»…åªæœ‰å‡ ç§’é’Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™äº› `.ts` è§†é¢‘æŒ‰ç…§é¡ºåºè¿›è¡Œåˆæˆä¸ºä¸€ä¸ªå¤§çš„å®Œæ•´è§†é¢‘ã€‚

ffmpeg åˆæˆè§†é¢‘å¯ä»¥ä½¿ç”¨ `concat` å‚æ•°ã€‚æ¯”å¦‚æˆ‘å½“å‰ç›®å½•ä¸‹æœ‰ä¸‰ä¸ª `.ts` è§†é¢‘ï¼š

```bash
$ ls
01.ts 02.ts 03.ts
```

å¦‚æœå°†è¦å°†è¿™ä¸‰ä¸ª ts è§†é¢‘æŒ‰é¡ºåºåˆæˆçš„è¯å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ˆè§†é¢‘åˆæˆé¡ºåºå°±æ˜¯ä½ æŒ‡å®šçš„é¡ºåºï¼‰ï¼š

```bash
ffmpeg -i "concat:1.ts|2.ts|3.ts" -c copy file.mp4
```

`-c` å‚æ•°æ˜¯ codec çš„æ„æ€ï¼Œå³ç¼–ç å™¨ã€‚æœ€åæŒ‡å®šè¾“å‡ºçš„è§†é¢‘æ–‡ä»¶åç§°ï¼Œå¦‚ file.mp4ã€‚

ä¸è¿‡ï¼Œä¸€èˆ¬ä¸€ä¸ªå®Œæ•´è§†é¢‘çš„ ts æ–‡ä»¶ä¼šæ¯”è¾ƒå¤šï¼ˆç»å¸¸ä¼šé‡åˆ°å‡ ç™¾ä¸ª ts æ–‡ä»¶ï¼‰ã€‚å¯¹äºè¿™ç§æƒ…å†µå†ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œçš„è¯å°±å¾ˆéš¾å—äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ª `file.txt` æ–‡ä»¶æ¥å‘Šè¯‰å®ƒè¦åˆå¹¶å“ªäº›æ–‡ä»¶ã€‚æ–‡ä»¶å†…éƒ¨æ ¼å¼å¦‚ä¸‹ï¼š

```bash
file /path/01.ts
file 02.ts
file ./../ 3.ts
```

å‰é¢ä¸ºå…³é”®è¯ fileï¼Œ åé¢è·Ÿä¸Šè§†é¢‘çš„åœ°å€ï¼ˆç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼‰ã€‚ ffmpeg å°†ä¼šæŒ‰ç…§ txt æ–‡ä»¶ä¸­çš„é¡ºåºå°†è§†é¢‘åˆå¹¶ã€‚ç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥äº†ï¼š

```bash
$ ffmpeg -f concat -i file.txt -c copy file.mp4
# æˆ–è€…
$ ffmpeg -f concat -i file.txt -acodec copy -vcodec copy -f mp4 file.mp4
```

å¦‚æœå¾—åˆ°ä¸€äº›åƒä¸‹é¢çš„é”™è¯¯ï¼š

```log
file.txt: Operation not permitted
```

æ·»åŠ ä¸ªå‚æ•° `-safe 0`ï¼š

```bash
$ ffmpeg -f concat -safe 0 -i file.txt -c copy file.mp4
```

å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è¯å°±ä¼šçœ‹åˆ°å¤šå‡ºä¸€ä¸ªåä¸º file.mp4 çš„æ–‡ä»¶ã€‚

**ç‰¹åˆ«è¯´æ˜ï¼š**

ä¸Šé¢ç¤ºä¾‹åªæ˜¯ä»¥ `.ts` æ–‡ä»¶ä¸ºä¾‹åšè¯´æ˜ï¼Œå¹¶ä¸ä»£è¡¨ä¸èƒ½åˆå¹¶å…¶ä»–æ ¼å¼çš„è§†é¢‘æ–‡ä»¶ã€‚`ffmpeg` çš„ç‰›é€¼ä¹‹å¤„ä¸åœ¨äºèƒ½å¤Ÿåˆå¹¶è§†é¢‘ï¼Œè¿˜å¯ä»¥å°†éŸ³è§†é¢‘åˆ†ç¦»çš„ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶ã€‚

æ¯”å¦‚å°†è§†é¢‘æ–‡ä»¶ï¼ˆexample.mp4ï¼‰å’ŒéŸ³é¢‘æ–‡ä»¶ï¼ˆexample.m4aï¼‰è¿›è¡Œåˆå¹¶ï¼š

```bash
ffmpeg -i example.mp4 -i example.m4a -c:a copy -c:v copy output.mp4
```

# è§†é¢‘æˆªå–

è¯­æ³•ç¤ºä¾‹ï¼š

```bash
ffmpeg -ss 00:00:00 -to 00:00:15 -i æºæ–‡ä»¶å -vcodec copy -acodec copy ç›®æ ‡æ–‡ä»¶å -y
ffmpeg -ss 00:00:00 -t 15 -i æºæ–‡ä»¶å -vcodec copy -acodec copy ç›®æ ‡æ–‡ä»¶å -y
```

å‚æ•°è¯´æ˜ï¼š

```log
-i                  è¡¨ç¤ºæºè§†é¢‘æ–‡ä»¶
-ss time_start      è®¾ç½®ä»è§†é¢‘æˆªå–å¼€å§‹ä½ç½®ï¼Œå¦‚ 00:00:10 è¡¨ç¤ºä»è§†é¢‘çš„ç¬¬10så¼€å§‹æˆªå–

-to time_end        è®¾ç½®è§†é¢‘æˆªå–çš„ç»“æŸä½ç½®ï¼Œå¦‚ 00:20:00 è¡¨ç¤ºä» time_start ä¸€ç›´æˆª
                    å–åˆ°è§†é¢‘çš„ç¬¬ 20 åˆ†é’Ÿï¼ˆå¦‚æœçœç•¥åˆ™è¡¨ç¤ºå¼€å§‹ä» time_start å¼€å§‹æˆª
                    å–å…¨éƒ¨è§†é¢‘ï¼‰

-t time_duration    ä¸ -to ä¸€æ ·ï¼Œä¸è¿‡æŒ‡å®šçš„æ˜¯å…·ä½“çš„æ—¶é•¿ï¼Œå•ä½æ˜¯ç§’ã€‚å¦‚ -t 20 è¡¨ç¤ºä»
                    time_start å¼€å§‹å‘åæˆªå– 20 ç§’

-vcodec copy        è¡¨ç¤ºä½¿ç”¨è·ŸåŸè§†é¢‘ä¸€æ ·çš„è§†é¢‘ç¼–è§£ç å™¨ï¼ˆå³ä¸æ”¹å˜ä»»ä½•æ•°æ®ï¼‰

-acodec copy        è¡¨ç¤ºä½¿ç”¨è·ŸåŸè§†é¢‘ä¸€æ ·çš„éŸ³é¢‘ç¼–è§£ç å™¨ï¼ˆå³ä¸æ”¹å˜ä»»ä½•æ•°æ®ï¼‰

-y                  è¡¨ç¤ºå¦‚æœè¾“å‡ºæ–‡ä»¶å·²å­˜åœ¨åˆ™è¦†ç›–ï¼ˆå¯ä»¥çœç•¥ï¼‰
```

åœ¨åšè§†é¢‘æˆªå–æ—¶è§†é¢‘è´¨é‡ä¼šé€šå¸¸ä¼šæœ‰ä¸€å®šçš„æŸå¤±ï¼Œå¦‚æœæƒ³è¦ä¿æŒåŸè§†é¢‘è´¨é‡æˆªå–çš„è¯å¯ä»¥é€šè¿‡æŒ‡å®š `-vcodec copy -acodec copy` ä¸¤ä¸ªå‚æ•°ã€‚å½“ç„¶äº†ï¼Œæˆªå–çš„ç›®æ ‡æ–‡ä»¶çš„åç¼€æœ€å¥½ä¹Ÿä¸åŸæ–‡ä»¶ä¹Ÿä¿æŒä¸€è‡´ã€‚

|**æ³¨æ„**|
|:-------|
|å‚æ•° `-ss` æœ€å¥½æ”¾åœ¨ `-i æºæ–‡ä»¶å` çš„å‰é¢ï¼Œå¦‚æœæ”¾åœ¨åé¢åˆ™ `-to` çš„å«ä¹‰å°±å˜äº†ï¼Œå˜æˆäº†ä¸ `-t` ä¸€æ ·çš„æ•ˆæœäº†ã€‚å˜æˆäº†æˆªå–å¤šé•¿è§†é¢‘ï¼Œè€Œä¸æ˜¯æˆªå–åˆ°è§†é¢‘æŒ‡å®šçš„ä½ç½®ã€‚æ‰€ä»¥ä¸€å®šè¦ç‰¹åˆ«æ³¨æ„ `-ss` çš„ä½ç½®ã€‚|

çœ‹ä¸ªç¤ºä¾‹ï¼š

```bash
$ ls -lh
total 236360
-rw-r--r--@ 1 mingrn97  staff   115M Nov  8 11:33 æ–‡ä»¶ç³»ç»Ÿ.flv
```

è§†é¢‘æ€»æ—¶é•¿ä¸º 27 åˆ†é’Ÿï¼Œç°åœ¨ä»¥ååˆ†é’Ÿè¿›è¡Œä¸€ä¸ªåˆ‡å‰²ï¼Œå…±åˆ‡å‰²æˆä¸‰ä¸ªè§†é¢‘ï¼Œä¹‹åçœ‹ä¸‹ä¸‰ä¸ªè§†é¢‘çš„å¤§å°åŠ èµ·æ¥æ˜¯å¦ä¸åŸè§†é¢‘å¤§å°ä¸€è‡´ï¼š

```bash
$ ffmpeg -ss 00:00:00 -to 00:10:00 -i æ–‡ä»¶ç³»ç»Ÿ.flv -vcodec copy -acodec copy æ–‡ä»¶ç³»ç»Ÿ1.flv
$ ffmpeg -ss 00:10:00 -to 00:20:00 -i æ–‡ä»¶ç³»ç»Ÿ.flv -vcodec copy -acodec copy æ–‡ä»¶ç³»ç»Ÿ2.flv
$ ffmpeg -ss 00:20:00 -i æ–‡ä»¶ç³»ç»Ÿ.flv -vcodec copy -acodec copy æ–‡ä»¶ç³»ç»Ÿ3.flv
```

ç»“æœï¼š

```bash
$ ls -lh
total 472920
-rw-r--r--@ 1 mingrn97  staff   115M Nov  8 11:33 æ–‡ä»¶ç³»ç»Ÿ.flv
-rw-r--r--  1 mingrn97  staff    43M Mar 24 17:31 æ–‡ä»¶ç³»ç»Ÿ1.flv
-rw-r--r--  1 mingrn97  staff    42M Mar 24 17:33 æ–‡ä»¶ç³»ç»Ÿ2.flv
-rw-r--r--  1 mingrn97  staff    31M Mar 24 17:33 æ–‡ä»¶ç³»ç»Ÿ3.flv
```

|**Note**|
|:-------|
|æ³¨æ„çœ‹ç¬¬ä¸‰æ¬¡æˆªå–è§†é¢‘çš„å‘½ä»¤ï¼Œä»…æŒ‡å®šäº†å¼€å§‹æˆªå–è§†é¢‘æ—¶é—´ï¼ˆ`-ss 00:20:00`ï¼‰ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æˆªå–çš„ç»“æŸæ—¶é—´ã€‚åƒè¿™æ ·åªæœ‰å¼€å§‹æ²¡æœ‰ç»“æŸçš„ç”¨æ³•è¡¨ç¤ºçš„æ˜¯ä»æŒ‡å®šçš„å¼€å§‹æ—¶é—´æˆªå–åˆ°è§†é¢‘ç»“å°¾ã€‚|

# æå–éŸ³é¢‘

ä½¿ç”¨ffmpegå¯ä»¥å¾ˆè½»æ˜“ä»åŸè§†é¢‘ä¸­æŠ½å–å‡ºå…¶ä¸­çš„éŸ³é¢‘å’Œè§†é¢‘ï¼ŒæŠ½å–éŸ³é¢‘çš„å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
ffmpeg -i input.mp4 -vn -c:a copy output.acc
```

`-vn` è¡¨ç¤º no videoï¼Œ`-c:a` æ˜¯ codec of audio çš„æ„æ€ï¼ˆä¹Ÿå¯ç›´æ¥ä½¿ç”¨ `-acodec`ï¼‰ï¼Œcopy æ˜¯ç›´æ¥æ‹·è´è§†é¢‘ä¸­çš„åŸå§‹çš„éŸ³é¢‘ï¼Œè¿™é‡Œä¸ä¼šæ¶‰åŠéŸ³é¢‘çš„ç¼–è§£ç ï¼Œé€Ÿåº¦ä¼šå¾ˆå¿«ã€‚

å¯¹äºæ‹·è´åçš„éŸ³é¢‘æµæ–‡ä»¶åº”è¯¥ä½¿ç”¨ä»€ä¹ˆåç¼€åå¯ä»¥ä½¿ç”¨ `ffprobe` è¿›è¡Œç¡®å®šè§†é¢‘ä¸­çš„éŸ³é¢‘æµæ ¼å¼ï¼Œç¤ºä¾‹ï¼š

```bash
ffprobe input.mp4

...
  Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 195 kb/s (default)
...
```

è¿™é‡Œçš„ input.mp4 è§†é¢‘æ–‡ä»¶ä¸­çš„éŸ³é¢‘æµæ˜¯ acc ç¼–ç æ ¼å¼ï¼Œé‚£æˆ‘å°±ä½¿ç”¨ acc å°±å¥½äº†~

--

å¦‚æœä½¿ç”¨ä¸Šé¢ä¸¤æ¡ç¤ºä¾‹å‘½ä»¤æå– mp3 çš„è¯ï¼Œå¯èƒ½ä¼šå‡ºç°ç±»ä¼¼ä¸‹é¢çš„é”™è¯¯ï¼š

```log
[mp3 @ 0x7fe2637062c0] Invalid audio stream. Exactly one MP3 audio stream is required.
Could not write header for output file #0 (incorrect codec parameters ?): Invalid argument
```

è¿™æ˜¯å› ä¸ºæå– mp3 ä¸éœ€è¦åŠ ä»»ä½•å‚æ•°ï¼Œç›´æ¥è¿™ä¹ˆæå–å°±å¯ä»¥äº†ï¼š

```bash
ffmpeg -i video.mp4 video.mp3
```

--

éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ`ffmpeg` é»˜è®¤ä¼šä»¥ `124kbps` æ¥æå–éŸ³é¢‘ï¼Œè¿™æ ·å¦‚æœè§†é¢‘è´¨é‡å¾ˆé«˜çš„è¯æˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªå…¨æŸéŸ³è´¨çš„éŸ³é¢‘ï¼Œæ‰€ä»¥è¿˜å¯ä»¥åŠ ä¸Š `-ab` å‚æ•°æŒ‡å®šéŸ³é¢‘çš„æ¯”ç‰¹ç‡ã€‚

æ¯”å¦‚ä»¥ 320k çš„æ¯”ç‰¹ç‡è¾“å‡ºéŸ³é¢‘ï¼š

```bash
ffmpeg -i video.mp4 -ab 320k video.mp3
```

|**Note**|
|:-------|
|ä¹‹æ‰€ä»¥é€‰æ‹© `320Kbps` çš„ç ç‡æ˜¯å› ä¸ºè¯¥å€¼æ˜¯ mp3 æ ¼å¼çš„æœ€é«˜ç ç‡~|

# æå–è§†é¢‘

æå–è§†é¢‘çš„å‘½ä»¤ä¸éŸ³é¢‘å¦‚å‡ºä¸€è¾™ï¼Œå¦‚ä¸‹ï¼š

```bash
ffmpeg -i input.mp4 -an -c:a copy output.mp4
```

`-an` è¡¨ç¤º no audioï¼Œå…¶ä»–å…³äºè§†é¢‘çš„å‚æ•°éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå…·ä½“å°±ä¸å¤šè¯´äº†ã€‚


# è§†é¢‘å€é€Ÿæ’­æ”¾

è§†é¢‘æµçš„æ’­æ”¾é€Ÿåº¦å¯ä»¥é€šè¿‡æ”¹å˜æ¯å¸§çš„æ˜¾ç¤ºæ—¶é—´æˆ³ï¼ˆPTSï¼‰æ¥æ”¹å˜ã€‚æœ‰ä¸¤ç§å®ç°æ–¹æ³•ï¼š

1ï¼‰é€šè¿‡å°†è§†é¢‘å¯¼å‡ºä¸º **åŸå§‹æ¯”ç‰¹æµ** æ ¼å¼æ¥å®ç°æ“¦é™¤æ—¶é—´æˆ³ï¼Œå¹¶åœ¨åˆ›å»ºæ–°æ—¶é—´æˆ³æ—¶å°†å…¶å¤ç”¨åˆ°åˆ°å®¹å™¨ä¸­ã€‚

2ï¼‰ä½¿ç”¨ setpts è§†é¢‘è¿‡æ»¤å™¨ï¼Œä½†æ˜¯éœ€è¦é‡æ–°ç¼–ç ã€‚

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨â€œåŸå§‹æ¯”ç‰¹æµâ€å®ç°è§†é¢‘å€é€Ÿæ’­æ”¾

ä½¿ç”¨â€œåŸå§‹æ¯”ç‰¹æµâ€å®ç°éŸ³è§†é¢‘å€é€Ÿæ’­æ”¾æ˜¯æ— æŸçš„ï¼Œä¹Ÿæ˜¯æ¨èçš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼é™¤äº†æ›´æ”¹æ—¶é—´æˆ³å¤–ï¼Œè¿˜ä¼šåŸæ ·å¤åˆ¶è§†é¢‘æµã€‚ä¸è¿‡å‰ææ˜¯ï¼šå°†è§†é¢‘å¤åˆ¶åˆ°åŸå§‹æ¯”ç‰¹æµæ ¼å¼ã€‚

**ç¡®å®šè§†é¢‘ç¼–ç åŠå¸§ç‡ï¼š**

å°†è§†é¢‘å¤åˆ¶åˆ°åŸå§‹æ¯”ç‰¹æµæ ¼å¼æˆ‘ä»¬éœ€è¦çŸ¥é“è¯¥è§†é¢‘çš„ç¼–ç æ ¼å¼ï¼Œæ¯”å¦‚ H.264ã€H.265ã€‚å¦‚æœä½ ä¸çŸ¥é“ç›®æ ‡è§†é¢‘æ–‡ä»¶æ˜¯ä»€ä¹ˆç¼–ç æ ¼å¼å¯ä»¥å€ŸåŠ© `ffprobe` å·¥å…·æŸ¥çœ‹ã€‚

æ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ª mp4 æ ¼å¼çš„è§†é¢‘æ–‡ä»¶ input.mp4ï¼Œæˆ‘å°±å¯ä»¥ä½¿ç”¨ `ffprobe` æŸ¥çœ‹è¯¥è§†é¢‘çš„å¤´ä¿¡æ¯ï¼š

```bash
$ ffprobe input.mp4

...
Input #0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':
  Metadata:
    major_brand     : isom
    minor_version   : 512
    compatible_brands: isomiso2mp41
    encoder         : Lavf59.27.100
    description     : Packed by Bilibili XCoder v2.0.2
  Duration: 00:01:42.74, start: 0.000000, bitrate: 1735 kb/s
  Stream #0:0[0x1](und): Video: hevc (Main) (hev1 / 0x31766568), yuv420p(tv, bt709), 3840x2160 [SAR 1:1 DAR 16:9], 1529 kb/s, 52.47 fps, 52 tbr, 16k tbn (default)
    Metadata:
      handler_name    : VideoHandler
      vendor_id       : [0][0][0][0]
  Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 195 kb/s (default)
    Metadata:
      handler_name    : SoundHandler
      vendor_id       : [0][0][0][0]
  Stream #0:2[0x3]: Subtitle: mov_text (tx3g / 0x67337874), 0 kb/s (default)
    Metadata:
      handler_name    : SubtitleHandler
```

æ³¨æ„çœ‹ç¬¬ä¸€è¡Œæµä¿¡æ¯ï¼š

```log
Stream #0:0[0x1](und): Video: hevc (Main) (hev1 / 0x31766568), yuv420p(tv, bt709), 3840x2160 [SAR 1:1 DAR 16:9], 1529 kb/s, 52.47 fps, 52 tbr, 16k tbn (default)
```

è¿™è¡Œä¿¡æ¯è¡¨ç¤ºï¼Œç¬¬ä¸€ä¸ªæµæ˜¯è§†é¢‘æµï¼Œè§†é¢‘ç¼–ç æ ¼å¼æ˜¯ hevcï¼ˆå°è£…æ ¼å¼ä¸º hev1ï¼‰ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä¿—ç§°çš„ H.265æ ¼å¼ã€‚æ¯ä¸€å¸§çš„æ•°æ®è¡¨ç¤ºä¸º yuv420pï¼Œåˆ†è¾¨ç‡ä¸º3840x2160ï¼Œè¿™è·¯æµçš„æ¯”ç‰¹ç‡ä¸º 1529 kb/sï¼Œå¸§ç‡ï¼ˆfpsï¼‰ä¸ºæ¯ç§’é’Ÿ 52.47 å¸§ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±ç¡®å®šäº†è§†é¢‘ç¼–ç æ ¼å¼ï¼ˆH.265ï¼‰å’Œè§†é¢‘å¸§ç‡ï¼ˆ52.47ï¼‰ï¼ŒåŒæ—¶æˆ‘çš„è§†é¢‘æ—¶é•¿ä¸º 1:42.74ã€‚

**å°†è§†é¢‘å¤åˆ¶åˆ°åŸå§‹æ¯”ç‰¹æµæ ¼å¼ï¼š**

- å¤åˆ¶ H.264 è§†é¢‘åŸå§‹æ¯”ç‰¹æµæ ¼å¼ï¼š

```bash
ffmpeg -i input.mp4 -map 0:v -c:v copy -bsf:v h264_mp4toannexb raw.h264
```

- å¤åˆ¶ H.265 è§†é¢‘åŸå§‹æ¯”ç‰¹æµæ ¼å¼ï¼š

```bash
ffmpeg -i input.mp4 -map 0:v -c:v copy -bsf:v hevc_mp4toannexb raw.h265
```

--

å…¶ä¸­ï¼Œ`-i` å‚æ•°åé¢çš„ input.mp4 å°±æ˜¯ä½ çš„å…·ä½“è§†é¢‘æ–‡ä»¶ï¼Œæœ€åäº§ç”Ÿå¯¹åº”çš„ raw.h264 æˆ– raw.h265 æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚

**æ‰§è¡Œè½¬æ¢ï¼š**

å¾—åˆ°åŸå§‹æ¯”ç‰¹æµæ ¼å¼æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥å®ç°å€é€Ÿè½¬æ¢äº†ã€‚å€é€Ÿè½¬æ¢çš„åŸç†å°±æ˜¯ä¿®æ”¹ â€œå¸§ç‡â€ã€‚åœ¨å‰é¢æˆ‘å·²ç»å¾—åˆ°çš„æˆ‘çš„è§†é¢‘å¸§ç‡ä¸º 52.47ï¼Œå¦‚æœæƒ³è¦å®ç°å€é€Ÿé‚£æˆ‘åªéœ€è¦å°†æ¯ç§’çš„å¸§ç‡æŒ‰ç…§å€æ•°æ”¾å¤§å³å¯ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦å®ç°å€é€Ÿæ’­æ”¾ï¼Œé‚£ä¹ˆå°±è¦å°†å¸§ç‡ æ”¾å¤§äºŒå€ï¼š`52.47 x 2 = 104.94`ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ç°äºŒå€é€Ÿæ’­æ”¾çš„å¸§ç‡ä¸º 104.94ã€‚å› æ­¤ï¼Œæˆ‘åªéœ€è¦ä½¿ç”¨ -r å‚æ•°æŒ‡å®šæ–°çš„é€Ÿç‡å³å¯ï¼

```bash
ffmpeg -fflags +genpts -r 104.94 -i raw.h265 -c:v copy output.mp4
```

ä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ç§å®ç°æ–¹å¼åªé€‚ç”¨äºæ²¡æœ‰éŸ³é¢‘æµçš„è§†é¢‘æ–‡ä»¶ï¼Œå³è§†é¢‘æ²¡æœ‰å£°éŸ³ã€‚ä½†å¦‚æœä½ çš„è§†é¢‘æœ‰å£°éŸ³çš„è¯åœ¨å®ç°å€é€Ÿè½¬æ¢æ—¶è¿˜éœ€è¦åŠ ä¸ŠéŸ³é¢‘å‚æ•°å¯¹éŸ³é¢‘æµåšäºŒå€æ•°å¤„ç†ã€‚

ä¿®æ”¹éŸ³é¢‘æµå€é€Ÿçš„ä¸»è¦å‚æ•°æ˜¯ `atempo`ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æœ€ç»ˆå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
ffmpeg -fflags +genpts -r 104.94 -i raw.h265 -i input.mp4 -map 0:v -c:v copy -map 1:a -af atempo=2 -movflags faststart output.mp4
```

## æ–¹æ³•äºŒï¼šä½¿ç”¨ setpts è§†é¢‘è¿‡æ»¤å™¨

ä½¿ç”¨è§†é¢‘è¿‡æ»¤å™¨æ¥å®ç°å€é€Ÿæ’­æ”¾çš„åŸç†æ˜¯è¿‡æ”¹å˜æ¯ä¸ªè§†é¢‘å¸§çš„æ˜¾ç¤ºæ—¶é—´æˆ³ï¼ˆPTSï¼‰æ¥å®ç°ã€‚

**æå–è§†é¢‘æµå¹¶å®ç°å€é€Ÿæ’­æ”¾ï¼š**

åŸºæœ¬ç¤ºä¾‹å¦‚ä¸‹ï¼š

```
ffmpeg -i input.mkv -an -c:a copy -filter:v "setpts=1*PTS" output.mkv
```

`-filter:v` å‚æ•°è¡¨ç¤ºå¯¹è§†é¢‘æµæ‰§è¡Œè¿‡æ»¤ï¼ˆ`v` è¡¨ç¤º videoï¼‰ï¼Œåé¢è·Ÿçš„å°±æ˜¯å…·ä½“çš„è¿‡æ»¤å™¨å‚æ•°ï¼Œæ¯”å¦‚ "setpts=1*PTS" å°±æ˜¯æ­£å¸¸æ˜¯è§†é¢‘å€é€Ÿï¼Œå¦‚æœæœ‰å¤šä¸ªè¿‡æ»¤å‚æ•°å°±ä½¿ç”¨è‹±æ–‡ `,` åˆ†éš”å³å¯ã€‚

å¦‚æœæƒ³è¦å®ç°å¿«å€é€Ÿæ’­æ”¾å°±å°† PTS æŒ‰ç…§å€é€Ÿç¼©å°å³å¯ï¼Œæ¯”å¦‚ "setpts=PTS/2" æˆ– "setpts=PTS*0.5" è¡¨ç¤ºçš„å°±æ˜¯å¿«å€æ’­æ”¾ï¼Œ"setpts=PTS/4" æˆ– "setpts=PTS*0.25" è¡¨ç¤ºçš„å°±æ˜¯å¿«4å€æ’­æ”¾ã€‚

ç›¸åï¼Œ"setpts=PTS*2" è¡¨ç¤ºçš„å°±æ˜¯æ…¢å€æ’­æ”¾ï¼Œ"setpts=PTS*4" è¡¨ç¤ºçš„å°±æ˜¯æ…¢4å€æ’­æ”¾ã€‚

æ³¨æ„ï¼šè¯¥å‘½ä»¤åªé’ˆå¯¹æ²¡æœ‰éŸ³é¢‘æµçš„è§†é¢‘æ–‡ä»¶ï¼Œå¦‚æœä½ çš„è§†é¢‘æ–‡ä»¶å­˜åœ¨éŸ³é¢‘æµä¸è¦ä½¿ç”¨è¯¥å‘½ä»¤å®ç°å€é€Ÿè½¬æ¢ã€‚

**æå–éŸ³é¢‘æµå¹¶å®ç°å€é€Ÿæ’­æ”¾ï¼š**

åŸºæœ¬ç¤ºä¾‹å¦‚ä¸‹ï¼š

```bash
ffmpeg -i input.mkv -vn -c:a copy -filter:a "atempo=1.0" output.acc
```

`-filter:a` å‚æ•°è¡¨ç¤ºå¯¹è§†é¢‘ä¸­çš„éŸ³é¢‘æµæ‰§è¡Œè¿‡æ»¤ï¼ˆ`a` è¡¨ç¤º audioï¼‰ï¼Œåé¢è·Ÿçš„å°±æ˜¯å…·ä½“çš„è¿‡æ»¤å™¨å‚æ•°ï¼Œæ¯”å¦‚ "atempo=1.0" å°±æ˜¯æ­£å¸¸æ˜¯éŸ³é¢‘å€é€Ÿï¼Œå¦‚æœæœ‰å¤šä¸ªè¿‡æ»¤å‚æ•°å°±ä½¿ç”¨è‹±æ–‡ `,` åˆ†éš”å³å¯ã€‚

å¦‚æœæƒ³è¦å¯¹éŸ³é¢‘å®ç°å¿«å€é€Ÿæ’­æ”¾å°±å°† atempo æŒ‰ç…§å€æ•°æ‰©å¤§å³å¯ï¼Œæ¯”å¦‚ "atempo=2.0" è¡¨ç¤ºçš„å°±æ˜¯å¿«å€æ’­æ”¾ï¼Œ"atempo=0.5" è¡¨ç¤ºçš„å°±æ˜¯æ…¢å€æ’­æ”¾ã€‚

ç‰¹åˆ«å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œatempo å–å€¼å‚æ•°ä¸º [0.5,2]ã€‚ä¹Ÿå°±æ˜¯è¯´åªèƒ½å®ç°å¿«å€æˆ–æ…¢å€ï¼Œæ— æ³•å®ç°å››å€é€Ÿã€‚å¦‚æœæƒ³è¦å®ç°å››å€é€Ÿå°±ä½¿ç”¨è‹±æ–‡ `,` åˆ†éš”æŒ‡å®šå¤šæ¬¡å³å¯ã€‚æ¯”å¦‚å¿«å››å€ï¼š

```bash
ffmpeg -i input.mkv -vn -c:a copy -filter:a "atempo=2.0,atempo=2.0" output.acc
```

**å¯¹éŸ³è§†é¢‘å®ç°å€é€Ÿæ’­æ”¾ï¼š**

è¿™ä¸ªå‘½ä»¤å…¶å®å°±æ˜¯å‰é¢ä¸¤ä¸ªå‘½ä»¤çš„æ··åˆï¼š

```bash
ffmpeg -i input.mkv -filter_complex "[0:v]setpts=0.5*PTS[v];[0:a]atempo=2.0[a]" -map "[v]" -map "[a]" output.mkv
```

--

# èµ„æºé“¾æ¥

https://trac.ffmpeg.org/wiki/How%20to%20speed%20up%20/%20slow%20down%20a%20video